{
  "version": 3,
  "file": "ll-v8-stack.js",
  "sourceRoot": "..\\..\\",
  "sources": [
    "src\\lib\\ll-v8-stack.coffee"
  ],
  "names": [],
  "mappings": "AAAoB;AAEpB,OAAO,OAAP,MAAA;;AAEA,OAAA;EACC,KADD;EACQ,OADR;EACiB,UADjB;EAC6B,UAD7B;EACyC,SADzC;EACoD,QADpD;CAAA,MAAA;;AAGA,OAAA;EAAQ,UAAR;CAAA,MAAA,kCAPoB;;;;;;;;;;;;;;AAsBpB,OAAA,IAAO,OAAA,GAAU,CAAC,KAAD,CAAA,GAAA;AAEjB,MAAA,MAAA,EAAA,QAAA,EAAA,IAAA,EAAA;EAAC,CAAA,CAAC,IAAD,EAAO,QAAP,EAAiB,IAAjB,EAAuB,MAAvB,CAAA,GAAiC,KAAjC;AACA,SAAO,CAAA,CAAA,CAAG,IAAH,CAAA,IAAA,CAAA,CAAc,QAAd,CAAA,CAAA,CAAA,CAA0B,IAA1B,CAAA,CAAA,CAAA,CAAkC,MAAlC,CAAA;AAHS,EAtBG;;;;AA8BpB,OAAA,IAAO,eAAA,GAAkB,CAAC,QAAD,CAAA,GAAA;AAEzB,MAAA;EAAC,IAAG,QAAA,GAAW,QAAQ,CAAC,KAAT,CAAe,mBAAf,CAAd;AACC,WAAO,QAAQ,CAAC,CAAD,EADhB;GAAA,MAAA;AAGC,WAAO,SAHR;;AAFwB,EA9BL;;;AAuCpB,OAAA,IAAO,UAAA,GAAa,CAAC,WAAS,CAAA,CAAV,CAAA,GAAA;AACpB,MAAA,KAAA,EAAA,CAAA,EAAA,YAAA,EAAA,QAAA,EAAA,WAAA;;EAEC,KAAA,GAAQ,QAAQ,CAAC,KAAT,IAAkB;AAE1B;IACC,QAAA,GAAW,KAAK,CAAC;IACjB,WAAA,GAAc,KAAK,CAAC;IAEpB,KAAK,CAAC,eAAN,GAAwB;IACxB,KAAK,CAAC,iBAAN,GAA0B,CAAC,KAAD,EAAQ,UAAR,CAAA,GAAA;AAC5B,UAAA,MAAA,EAAA,QAAA,EAAA,OAAA,EAAA,YAAA,EAAA,MAAA,EAAA,OAAA,EAAA,CAAA,EAAA,OAAA,EAAA,GAAA,EAAA,IAAA,EAAA,UAAA,EAAA,KAAA,EAAA,OAAA,EAAA,GAAA,EAAA,OAAA,EAAA;MAAG,OAAA,GAAU;MACV,KAAA,4CAAA;;QACC,OAAA,GAAU,KAAK,CAAC,WAAN,CAAA;QACV,IAAG,OAAA,CAAQ,OAAR,CAAH;UACC,OAAA,GAAU,YAAA,CAAa,OAAb;UACV,QAAA,GAAW,OAAO,CAAC,OAFpB;;QAIA,IAAG,CAAC,OAAO,QAAP,KAAmB,QAApB,CAAA,IAAiC,CAAC,QAAQ,CAAC,MAAT,GAAkB,CAAnB,CAApC;;UAEC,GAAA,GAAM,QAAQ,CAAC,OAAT,CAAiB,gBAAjB;UACN,IAAI,GAAA,IAAO,CAAX;YACC,IAAG,KAAH;cACC,OAAO,CAAC,GAAR,CAAY,CAAA,kBAAA,CAAA,CAAqB,QAArB,CAAA,CAAA,CAAZ,EADD;;AAEA,qBAHD;WAHD;;QAQA,OAAA,GAAU,KAAK,CAAC,WAAN,CAAA;QACV,OAAA,GAAU,KAAK,CAAC,OAAN,CAAA;QACV,YAAA,GAAe,KAAK,CAAC,eAAN,CAAA;QACf,UAAA,GAAa,KAAK,CAAC,aAAN,CAAA;QACb,IAAA,GAAO,KAAK,CAAC,aAAN,CAAA;QACP,MAAA,GAAS,KAAK,CAAC,eAAN,CAAA,EAlBb;;QAqBI,IAAG,KAAK,CAAC,MAAN,CAAA,CAAH;UACC,IAAA,GAAM,OADP;SAAA,MAEK,IAAG,KAAK,CAAC,QAAN,CAAA,CAAH;UACJ,IAAA,GAAO,SADH;SAAA,MAEA,IAAG,KAAK,CAAC,aAAN,CAAA,CAAH;UACJ,IAAA,GAAO,cADH;SAAA,MAEA,IAAG,OAAA,CAAQ,UAAR,CAAH;UACJ,IAAA,GAAO,SADH;SAAA,MAAA;UAGJ,IAAA,GAAO,WAHH;;QAKL,IAAG,KAAH;UACC,OAAO,CAAC,GAAR,CAAY,GAAG,CAAC,MAAJ,CAAW,EAAX,CAAZ;UACA,OAAO,CAAC,GAAR,CAAY,CAAA,QAAA,CAAA,CAAW,IAAX,CAAA,CAAA,CAAZ;UACA,OAAO,CAAC,GAAR,CAAY,CAAA,WAAA,CAAA,CAAc,OAAd,CAAA,CAAA,CAAZ;UACA,OAAO,CAAC,GAAR,CAAY,CAAA,YAAA,CAAA,CAAe,QAAf,CAAA,CAAA,CAAZ;UACA,OAAO,CAAC,GAAR,CAAY,CAAA,gBAAA,CAAA,CAAmB,YAAnB,CAAA,CAAA,CAAZ;UACA,OAAO,CAAC,GAAR,CAAY,CAAA,cAAA,CAAA,CAAiB,UAAjB,CAAA,CAAA,CAAZ;UACA,OAAO,CAAC,GAAR,CAAY,CAAA,GAAA,CAAA,CAAM,IAAN,CAAA,CAAA,CAAA,CAAc,MAAd,CAAA,CAAZ,EAPD;SAhCJ;;QA0CI,IAAI,OAAA,KAAW,WAAf;AACC,gBADD;;QAGA,MAAA,GAAS;UACR,IADQ;UAER,QAFQ;UAGR,QAAA,EAAU,eAAA,CAAgB,QAAhB,CAHF;UAIR,YAJQ;UAKR,IALQ;UAMR,MANQ;UAOR,OAAA,EAAS,KAAK,CAAC,OAAN,CAAA;QAPD;QAUT,IAAI,IAAA,KAAQ,QAAZ;UACC,MAAM,CAAC,OAAP,GAAiB;UACjB,MAAM,CAAC,UAAP,GAAoB,WAFrB;SAvDJ;;QA4DI,IAAG,CAAC,IAAA,KAAQ,UAAT,CAAA,IAAwB,UAAA,CAAW,YAAX,CAA3B;UACC,MAAM,CAAC,IAAP,GAAc;UACd,OAAO,MAAM,CAAC;UACd,OAAO,CAAC,IAAR,CAAa,MAAb;AACA,gBAJD;;QAMA,OAAA,GAAU,OAAO,CAAC,KAAR,CAAc,QAAd;QACV,MAAM,CAAC,GAAP,GAAa,OAAO,CAAC;QACrB,MAAM,CAAC,IAAP,GAAc,OAAO,CAAC;QACtB,MAAM,CAAC,GAAP,GAAa,OAAO,CAAC;QACrB,IAAI,OAAO,CAAC,GAAR,KAAe,KAAnB;UACC,MAAM,CAAC,IAAP,GAAc,UAAA,CAAW,QAAX,EAAqB,MAAM,CAAC,IAA5B,EADf;;QAEA,OAAO,CAAC,IAAR,CAAa,MAAb;MAzED;AA2EA,aAAO;IA7EkB;IA+E1B,YAAA,GAAe,IAAI,KAAJ,CAAA,CAAW,CAAC;IAC3B,SAAA,CAAW,YAAY,CAAC,MAAb,GAAsB,CAAjC,EAAqC,wBAArC,EApFF;;IAuFE,KAAK,CAAC,eAAN,GAAwB;IACxB,KAAK,CAAC,iBAAN,GAA0B,YAzF3B;GA0FA,cAAA;IAAM;AACL,WAAO,GADR;;AAEA,SAAO;AAjGY,EAvCA;;;AA4IpB,OAAA,IAAO,YAAA,GAAe,CAAC,GAAD,CAAA,GAAA;AAEtB,MAAA,CAAA,EAAA,GAAA,EAAA,GAAA,EAAA,QAAA,EAAA,OAAA,EAAA,QAAA,EAAA,OAAA,EAAA;EAAC,SAAA,CAAU,OAAA,CAAQ,GAAR,CAAV,EAAwB,gCAAxB;EACA,QAAA,GAAW,GAAG,CAAC,KAAJ,CAAU,iBAAV;EAIX,IAAG,OAAA,CAAQ,QAAR,CAAH;IACC,CAAC,CAAD,EAAI,OAAJ,CAAA,GAAe;IACf,CAAA;MAAC,GAAD;MAAM,IAAA,EAAK,QAAX;MAAqB,IAAA,EAAK,IAA1B;MAAgC;IAAhC,CAAA,GAAuC,OAAO,CAAC,KAAR,CAAc,OAAd,CAAvC;IACA,IAAG,OAAA,CAAQ,GAAR,CAAA,IAAgB,CAAC,GAAG,CAAC,OAAJ,CAAY,GAAZ,CAAA,KAAoB,CAArB,CAAnB;MACC,GAAA,GAAM,GAAG,CAAC,MAAJ,CAAW,CAAX,EADP;;AAEA,WAAO;MACN,GADM;MAEN,QAFM;MAGN,MAAA,EAAQ,CAAA,CAAA,CAAG,GAAH,CAAA,CAAA,CAAA,CAAU,QAAV,CAAA,CAHF;MAIN,IAJM;MAKN;IALM,EALR;GAAA,MAAA;IAaC,QAAA,GAAW,GAAG,CAAC,KAAJ,CAAU,uBAAV;IAIX,IAAG,OAAA,CAAQ,QAAR,CAAH;MACC,OAAA,GAAU;QACT,MAAA,EAAQ;MADC,EADX;KAAA,MAAA;MAKC,QAAA,CAAS,CAAA,mBAAA,CAAA,CAAsB,GAAtB,CAAA,CAAA,CAAT,EALD;KAjBD;;AAuBA,SAAO;AA9Bc,EA5IF;;;AA8KpB,OAAA,IAAO,kBAAA,GAAqB,CAAA,CAAA,GAAA;AAC5B,MAAA,GAAA,EAAA,QAAA,EAAA,KAAA,EAAA,CAAA,EAAA,MAAA,EAAA;AAQC;;;;;;;;IACC,MAAA,GAAS,UAAA,CAAA,EADV;GAEA,cAAA;IAAM;IACL,OAAO,CAAC,GAAR,CAAY,CAAA,uBAAA,CAAA,CAA0B,GAAG,CAAC,OAA9B,CAAA,CAAZ;AACA,WAAO,MAFR;;EAIA,QAAA,GAAW;EACX,KAAA,wCAAA;;IACC,IAAI,QAAA,KAAY,KAAhB;MACC,QAAA,GAAW,KAAK,CAAC,SADlB;KAAA,MAEK,IAAI,KAAK,CAAC,QAAN,KAAkB,QAAtB;AACJ,aAAO,MADH;;EAHN;AAMA,SAAO;AAtBoB,EA9KR;;;AAwMpB,OAAA,IAAO,iBAAA,GAAoB,CAAA,CAAA,GAAA;AAC3B,MAAA,GAAA,EAAA;AAQC;;;;;;;;IACC,MAAA,GAAS,UAAA,CAAA,EADV;GAEA,cAAA;IAAM;IACL,OAAO,CAAC,GAAR,CAAY,CAAA,uBAAA,CAAA,CAA0B,GAAG,CAAC,OAA9B,CAAA,CAAZ;AACA,WAAO,MAFR;;AAIA,SAAO,MAAM,CAAC,CAAD;AAfa",
  "sourcesContent": [
    "# ll-v8-stack.coffee\r\n\r\nimport pathLib from 'node:path'\r\n\r\nimport {\r\n\tundef, defined, notdefined, alldefined, ll_assert, ll_croak,\r\n\t} from '@jdeighan/base-utils'\r\nimport {mapLineNum} from '@jdeighan/base-utils/source-map'\r\n\r\n# ---------------------------------------------------------------------------\r\n# Stack Frames have the keys:\r\n#    type - eval | native | constructor | method | function | script\r\n#    filePath\r\n#    fileName\r\n#    functionName\r\n#    objTye, methodName - if type == 'method'\r\n#    isAsync - true if an async function/method\r\n#    line\r\n#    column\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport nodeStr = (hNode) =>\r\n\r\n\t{type, fileName, line, column} = hNode\r\n\treturn \"#{type} at #{fileName}:#{line}:#{column}\"\r\n\r\n# ---------------------------------------------------------------------------\r\n# --- export only for unit tests\r\n\r\nexport extractFileName = (filePath) =>\r\n\r\n\tif lMatches = filePath.match(/// [\\/\\\\] ([^\\/\\\\]+) $///)\r\n\t\treturn lMatches[1]\r\n\telse\r\n\t\treturn filePath\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport getV8Stack = (hOptions={}) =>\r\n\t# --- ignores any stack frames from this module\r\n\r\n\tdebug = hOptions.debug || false\r\n\r\n\ttry\r\n\t\toldLimit = Error.stackTraceLimit\r\n\t\toldPreparer = Error.prepareStackTrace\r\n\r\n\t\tError.stackTraceLimit = Infinity\r\n\t\tError.prepareStackTrace = (error, lCallSites) =>\r\n\t\t\tlFrames = []\r\n\t\t\tfor oSite in lCallSites\r\n\t\t\t\tfileURL = oSite.getFileName()\r\n\t\t\t\tif defined(fileURL)\r\n\t\t\t\t\thParsed = parseFileURL(fileURL)\r\n\t\t\t\t\tfilePath = hParsed.source\r\n\r\n\t\t\t\tif (typeof filePath == 'string') && (filePath.length > 0)\r\n\t\t\t\t\t# --- Ignore any stack entries from this module\r\n\t\t\t\t\tpos = filePath.indexOf('ll-v8-stack.js')\r\n\t\t\t\t\tif (pos >= 0)\r\n\t\t\t\t\t\tif debug\r\n\t\t\t\t\t\t\tconsole.log \"SKIP: filePath = '#{filePath}'\"\r\n\t\t\t\t\t\tcontinue\r\n\r\n\t\t\t\tobjType = oSite.getTypeName()\r\n\t\t\t\tthisVal = oSite.getThis()\r\n\t\t\t\tfunctionName = oSite.getFunctionName()\r\n\t\t\t\tmethodName = oSite.getMethodName()\r\n\t\t\t\tline = oSite.getLineNumber()\r\n\t\t\t\tcolumn = oSite.getColumnNumber()\r\n\r\n\t\t\t\t# --- Set type\r\n\t\t\t\tif oSite.isEval()\r\n\t\t\t\t\ttype ='eval'\r\n\t\t\t\telse if oSite.isNative()\r\n\t\t\t\t\ttype = 'native'\r\n\t\t\t\telse if oSite.isConstructor()\r\n\t\t\t\t\ttype = 'constructor'\r\n\t\t\t\telse if defined(methodName)\r\n\t\t\t\t\ttype = 'method'\r\n\t\t\t\telse\r\n\t\t\t\t\ttype = 'function'\r\n\r\n\t\t\t\tif debug\r\n\t\t\t\t\tconsole.log '-'.repeat(40)\r\n\t\t\t\t\tconsole.log \"type = '#{type}'\"\r\n\t\t\t\t\tconsole.log \"objType = '#{objType}'\"\r\n\t\t\t\t\tconsole.log \"filePath = '#{filePath}'\"\r\n\t\t\t\t\tconsole.log \"functionName = '#{functionName}'\"\r\n\t\t\t\t\tconsole.log \"methodName = '#{methodName}'\"\r\n\t\t\t\t\tconsole.log \"at #{line}:#{column}\"\r\n\r\n\t\t\t\t# --- Ignore this entry and any before it\r\n\t\t\t\tif (objType == 'ModuleJob')\r\n\t\t\t\t\tbreak\r\n\r\n\t\t\t\thFrame = {\r\n\t\t\t\t\ttype\r\n\t\t\t\t\tfilePath\r\n\t\t\t\t\tfileName: extractFileName(filePath)\r\n\t\t\t\t\tfunctionName\r\n\t\t\t\t\tline\r\n\t\t\t\t\tcolumn\r\n\t\t\t\t\tisAsync: oSite.isAsync()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\tif (type == 'method')\r\n\t\t\t\t\thFrame.objType = objType\r\n\t\t\t\t\thFrame.methodName = methodName\r\n\r\n\t\t\t\t# --- If main body of a script, stop here\r\n\t\t\t\tif (type == 'function') && notdefined(functionName)\r\n\t\t\t\t\thFrame.type = 'script'\r\n\t\t\t\t\tdelete hFrame.functionName\r\n\t\t\t\t\tlFrames.push hFrame\r\n\t\t\t\t\tbreak\r\n\r\n\t\t\t\thParsed = pathLib.parse(filePath)\r\n\t\t\t\thFrame.dir = hParsed.dir\r\n\t\t\t\thFrame.stub = hParsed.name\r\n\t\t\t\thFrame.ext = hParsed.ext\r\n\t\t\t\tif (hParsed.ext == '.js')\r\n\t\t\t\t\thFrame.line = mapLineNum filePath, hFrame.line\r\n\t\t\t\tlFrames.push hFrame\r\n\r\n\t\t\treturn lFrames\r\n\r\n\t\tlStackFrames = new Error().stack\r\n\t\tll_assert (lStackFrames.length > 0), \"lStackFrames is empty!\"\r\n\r\n\t\t# --- reset to previous values\r\n\t\tError.stackTraceLimit = oldLimit\r\n\t\tError.prepareStackTrace = oldPreparer\r\n\tcatch e\r\n\t\treturn []\r\n\treturn lStackFrames\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport parseFileURL = (url) =>\r\n\r\n\tll_assert defined(url), \"url is undef in parseFileURL()\"\r\n\tlMatches = url.match(///^\r\n\t\t\tfile : \\/\\/\r\n\t\t\t(.*)\r\n\t\t\t$///)\r\n\tif defined(lMatches)\r\n\t\t[_, pathStr] = lMatches\r\n\t\t{dir, base:fileName, name:stub, ext} = pathLib.parse(pathStr)\r\n\t\tif defined(dir) && (dir.indexOf('/') == 0)\r\n\t\t\tdir = dir.substr(1)   # --- strip leading '/'\r\n\t\treturn {\r\n\t\t\tdir\r\n\t\t\tfileName\r\n\t\t\tsource: \"#{dir}/#{fileName}\"\r\n\t\t\tstub\r\n\t\t\text\r\n\t\t\t}\r\n\telse\r\n\t\tlMatches = url.match(///^\r\n\t\t\t\tnode : internal \\/\r\n\t\t\t\t(.*)\r\n\t\t\t\t$///)\r\n\t\tif defined(lMatches)\r\n\t\t\thParsed = {\r\n\t\t\t\tsource: 'node'\r\n\t\t\t\t}\r\n\t\telse\r\n\t\t\tll_croak \"Invalid file url: '#{url}'\"\r\n\treturn hParsed\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport getMyOutsideCaller = () =>\r\n\t# --- Returned object has keys:\r\n\t#        type - eval | native | constructor | method | function\r\n\t#        functionName\r\n\t#        objType, methodName - if a method\r\n\t#        line\r\n\t#        column\r\n\t#        isAsync - if an async function\r\n\r\n\ttry\r\n\t\tlStack = getV8Stack()\r\n\tcatch err\r\n\t\tconsole.log \"ERROR in getV8Stack(): #{err.message}\"\r\n\t\treturn undef\r\n\r\n\tfileName = undef\r\n\tfor hNode in lStack\r\n\t\tif (fileName == undef)\r\n\t\t\tfileName = hNode.fileName\r\n\t\telse if (hNode.fileName != fileName)\r\n\t\t\treturn hNode\r\n\r\n\treturn undef\r\n\r\n# ---------------------------------------------------------------------------\r\n\r\nexport getMyDirectCaller = () =>\r\n\t# --- Returned object has keys:\r\n\t#        type - eval | native | constructor | method | function\r\n\t#        functionName\r\n\t#        objType, methodName - if a method\r\n\t#        line\r\n\t#        column\r\n\t#        isAsync - if an async function\r\n\r\n\ttry\r\n\t\tlStack = getV8Stack()\r\n\tcatch err\r\n\t\tconsole.log \"ERROR in getV8Stack(): #{err.message}\"\r\n\t\treturn undef\r\n\r\n\treturn lStack[1]\r\n"
  ]
}